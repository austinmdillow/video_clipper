# Video Clipper

A simple wrapper around `ffmpeg -ss HH:MM:SS -to HH:MM:S` inspired by [ErikThiart/VideoClipper](https://github.com/ErikThiart/VideoClipper).

Goals are
- quickly generate clips from an original video source without loss of quality or need to re-encode
- declaratively store clip information in a manifest so clips can be recreated
- detect if clips need to be recreated due to changes in the manifest or changes on disk
- see what's going to happen before making changes on disk (`--dryrun`)


## Requirements

- [ffmpeg](https://ffmpeg.org/)
- [uv](https://docs.astral.sh/uv/getting-started/installation/)
  - or just `pip install tdqm`


## Manifest

This tool uses a manifest file to describe what videos should be clipped. Paths are relative to `--input-dir`.

```json
{
    "version": "1",
    "videos": {
        "videoA.mp4": {
            "clips": {
                "videoA_0.mp4": {
                    "start": "00:00:27",
                    "end": "00:34:35",
                    "sha256_checksum": "d65135dc..."
                }
            }
        },
        "subfolder/videoB.mp4": {
            "clips": {
                "videoB_0.mp4": {
                    "start": "00:00:04",
                    "end": "00:29:12",
                    "sha256_checksum": "f02ff133..."
                },
                "videoB_1.mp4": {
                    "start": "00:29:14",
                    "end": "01:02:45",
                    "sha256_checksum": "none" // hasn't been clipped
                }
            }
        }
    }
}
```

Results of above manifest

```
$ uv run video_clipper.py clip --manifest example_manifest.json --input-dir ~/Downloads/videos/ --output-dir ~/Downloads/clips/
```

```
/home/user/Downloads/
├── clips
│   ├── videoA_0.mp4
│   ├── videoB_0.mp4
│   └── videoB_1.mp4
└── videos
    ├── subfolder
    │   └── videoB.mp4
    └── videoA.mp4
```

## CLI

You can replace `uv run` with `python3` if you do not have uv installed.

### `add`

Manually editing the manifest can be tedious. Do this instead.

```bash
$ uv run video_clipper.py add --manifest trim_manifest.json --filename videoA.mp4 --start 00:00:06 --end 00:11:28
```

### `clip`

By default, existing clips will not be overwritten.
```bash
$ uv run video_clipper.py clip --manifest manifest.json --input-dir videos/ --output-dir clips/
```

Check sha256sum of existing files and overwrite if they do not match the manifest.
```bash
$ uv run video_clipper.py clip --manifest manifest.json --input-dir videos/ --output-dir clips/ --overwrite
```

### `validate`

Include the `--output-dir` to check the sha256sum of the clips.
```bash
$ uv run video_clipper.py validate --manifest manifest.json --input-dir videos/ --output-dir clips/
```

### `prune`

Remove clips that are not in the manifest and _could_ have been generated by this tool. The file to delete must look like `{video name}_{number}.{video extension}`. You must confirm with `y` before deleting files.

For video `videoA.mp4`

- Deleted   `videoA_4.mp4`
- Retained  `videoA_4.mkv`
- Retained  `videoA.mp4`
- Retained  `id_rsa`

```bash
$ uv run video_clipper.py prune --manifest manifest.json --output-dir clips/
```

### `format`

Format your manifest file in place.

```bash
$ uv run video_clipper.py format --manifest manifest.json
```
